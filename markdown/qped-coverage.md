# Test Coverage Checker Tutorial

In this tutorial you will learn how to configure the Coverage Checker.
Therefore we will configure feedback for following assignment.

## Table of Contents
1. [General Information](#coverage-general-information)
2. [Used Example](#coverage-used-example)
3. [Configuration in Quarterfall](#coverage-config)
   1. [Configuration via MASS Configuration web form](#coverage-from-website)
   2. [Configuration Walkthrough](#coverage-configuration-walkthrough)
       1. [Exclude Methods by Type](#coverage-exclude-by-type)
       2. [Exclude Methods by Name](#coverage-exclude-by-name)
       3. [Private Base Implementation](#coverage-base-implementation)
       4. [Feedback Configuration](#coverage-feedback-configuation)
       5. [Program Format](#coverage-program-format)
       6. [Feedback Format](#coverage-feedback-format)
   3. [Transferring the Configuration to Quarterfall](#coverage-transferring-to-quarterfall)


## <a id="coverage-general-information"></a>General Information
The Test Coverage Checker is a part of the MASS Checker.
It generates feedback regarding to the completeness of tests written by a learner.
The approach of the checker is to perform a test coverage analysis while running the
tests in a student-submitted solution.
The base code, which is tested, can either be part of the student solution or predefined
base code can be provided by the teacher.
The feedback generated by this checker reports which lines of the base code are not
covered during the test execution.
To make feedback messages more specific, teachers can specify dedicated messages
associated with specified line numbers of un-covered code.
This is most useful when the base code is provided by the teacher, as the purpose of
these code lines is exactly known in this case.

## <a id="coverage-used-example"></a>Used Example

The example assignment used in this tutorial is to write tests for class `Even` shown below.

```java
class Even {
	public boolean isTrue(int num) {
		if (num % 2 == 0) {
			return true;
		} else {
			return false;
		}
	}
}
```

Thereby we anticipate three mistakes that students can make and for which we want to generate helpful feedback messages:
1. A test case fails.
2. The student solution only tested with an odd number as argument.
3. The student solution only tested with an even number as argument.

Naturally, compiler errors also lead to feedback generated by our checker, but this is not the subject of this tutorial.


## <a id="coverage-config"></a>Configuration in Quarterfall

First, we need to create a question is Quarterfall. Since students only need to provide a single class, they do not
need to submit multiple files. Instead, we decide to create a "Code question", which includes a text field where students
can immediately enter their solution.  As question text, we enter the following:

````markdown
Write the class `EvenTest` which tests the implementation of the class `Even` shown below.
This class just contains one method `isTrue` which is supposed to return `true` if the passed
integer value is an even number. 

```java
class Even {
	public boolean isTrue(int num) {
		if (num % 2 == 0) {
			return true;
		} else {
			return false;
		}
	}
}
```
````

For the Programming Lanaguage, select "Java" which will enable proper syntax highlighting in the solution text editor available to the students.
It is a good idea to provide a template for the solution to avoid that students make mistakes when naming their test class
and to rid them from needing to provide the required import statements. Therefore, we enter the following as the "Template":

```java
import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.Test;

class EvenTest {

   @Test
   void test() {
      fail("Not yet implemented");
   }

}
```

You could select the tab "Solution" in Quarterfall and provide a sample solution that can be shown to students.
But we leave this out for the tutorial.

Next, we need to configure the Mass checker. For this purpose, we select the "Feedback" tab and a Code action and a
Cloud check action.
For the basic steps to configure this feedback as well as the parameter values that need to be provided, please refer
to the main [MASS documentation](/mass/documentation)
The specific configuration of the Coverage Checker will be explained in this tutorial.

![Question in Quartefall.](images/cov_quarterfall-question.png)


### <a id="coverage-from-website"></a>Configuration via MASS Configuration web form
To specify the configuration, we use the [MASS Configuration web form](/mass/configurator).
The above link sends you directly to our configurator where you can configure all the Mass checkers.
But for this tutorial, we only need the Test Coverage Checker. To enable configuring this, select the check box
***Enable Test Coverage Checker*** in the web form.
Now, you should be able to see that ***Test Coverage Checker*** appears in the blue bar at the top as in the following screenshot.

![Mass configuration web form.](images/cov_web-form-coverage-enabled.png)

### <a id="coverage-configuration-walkthrough"></a>Configuration Walkthrough

Click on ***Test Coverage Checker*** and the configurator will let you configure this checker.

![Mass configuration web form page for the Test Coverage Checker.](images/cov_web-form-empty.png)

#### <a id="coverage-exclude-by-type"></a>Exclude Methods by Type

The top four check boxes let you select types of methods which should be excluded from
the coverage analysis.
In the example used in this tutorial, all methods should be considered, therefore, we leave these check boxes unchecked.

![Mass configuration web form - exclude by type.](images/cov_web-form-exclude-by-type.png)

#### <a id="coverage-exclude-by-name"></a>Exclude Methods by Name

If specific methods or all methods in specific classes are to be excluded, their names can be added to the "Exclude by Name" list.
Again, we do not want to exclude any methods and therefore do not add anything.
<!-- What is the format for specifying names? Fully qualified names? Methods just as class.method ? ... what about method overloading?-->

![Mass configuration web form - exclude by name.](images/cov_web-form-exclude-by-name.png)

#### <a id="coverage-base-implementation"></a>Private Base Implementation

For the assignment in this tutorial, we want to provide a predefined implementation of the class shown at the top.
For this purpose, we need to provide a ZIP file containing this class at a publicly accessible URL.
This URL is only known to the Feedback action in Quarterfall and cannot be determined by students,
therefore the implementation will not be accessible to students.
The ZIP file should contain the source files of the required classes and the folder structure within the ZIP file
should follow Java conventions (i.e., the default package is the root of the ZIP file and packages are sub folders).
For the purpose of this tutorial, we provide an appropriate ZIP file at this URL:

[https://qped-eu.github.io/mass/files/TeachersImplementation.zip](https://qped-eu.github.io/mass/files/TeachersImplementation.zip)

![Mass configuration web form - private base implementation.](images/cov_web-form-base-implementation.png)

#### <a id="coverage-feedback-configuation"></a>Feedback Configuration

Next, we will configure the feedback messages we want to generate.
There are three types of feedback that can be generated.
All of them are added to the "Feedback Configuration".
When you press the plus button, a text field is opened to enter the appropriate specification.
The value to be entered depends on the type of feedback you want to generate.
We discuss the three types below.

The first one is _feedback for failed test methods_.
There are several ways to configure this behavior:
If you want to report all test results as feedback, you must specify the following in the text field for the first feedback configuration:

```
:TEST
```

If you only want to include the test results for a specific class, you can put its name in front of the colon.
For example, to only include test results for the class `EventTest` you must enter the following into the text field `EvenTest:TEST`.
As both has the same effect in our case, we will use the first variant in this tutorial.

The second type of feedback is a custom message for un-covered code lines.
For our assignment, we want to give a hint to consider also even or odd numbers if one of the branches of the if statement was not covered.
For example, if the first branch of the if statement has never been executed during the test, we want to git as feedback message

```
You only tested the method with odd numbers.
```

To configure this feedback you need to provide the following information, all separated by a colon.
- The *classname* containing the un-covered code. 
- The *index* of the un-covered code. For this purpose you can either specify a line number or a method name.  
- The *feedback* to be shown.

The feedback to show starts by one of the keywords `COVERAGE` or `CUSTOM`.
In the first case, only the keyword is needed and a default message is shown, if the specified code line is not executed.
For more information, you can refer to our [documentation of the format for these configurations](/mass/documentation#coverage_feedback).

For the example assignment, we want to provide dedicated messages, when the lines 4 (executed for even number) and 6 (executed for odd numbers) are missed.
Therefore, we add two more items to the Feedback Configuration with the values:

```
Even:CUSTOM:4:You only tested the method with odd numbers.
```

and:

```
Even:CUSTOM:6:You only tested the method with even numbers.
```

![Mass configuration web form - feedback configuration.](images/cov_web-form-feedback.png)

#### <a id="coverage-program-format"></a>Program Format

The Text Coverage Checker supports student solutions which either follow the standard Java
naming conventions of the Maven naming conventions.
In the first case, test classes are required to have a name ending with `Test`.
And the fully qualified class name directly corresponds with the file name, which is in particular
relevant if students submit solutions with multiple source files packaged a ZIP file.
If the Maven conventions are followed, test classes are expected to be contained
in `test/java/` and all other classes to be in `main/java`.

For this tutorial, we expect students to follow the regular Java conventions and sepcify this accordingly in the web form.

![Mass configuration web form - program format.](images/cov_web-form-program-format.png)

#### <a id="coverage-feedback-format"></a>Feedback Format

It is possible to specify a Velocity template to enrich the generated feedback.
Information on this can be found in our [Github repository](https://github.com/qped-eu/MASS-checker/tree/master/src/main/java/eu/qped/java/checkers/coverage/doc.md).
For the purpose of this tutorial, we leave the optional field "Feedback Format" empty.

![Mass configuration web form - feedback format.](images/cov_web-form-feedback-format.png)


### <a id="coverage-transferring-to-quarterfall"></a>Transferring the Configuration to Quarterfall

After following the steps in this tutorial the web form should look like the following screenshot.

![Mass configuration web form finished.](images/cov_web-form-finished.png)

The following JSON object has been built which is shown either to the right of the web form or below it:

```json
{
   "styleSelected":false,
   "semanticsSelected":false,
   "coverageSelected":true,
   "classSelected":false,
   "metricsSelected":false,
   "syntax":{
      "level":"BEGINNER"
   },
   "coverage":{
      "privateImplementation":"https://qped-eu.github.io/mass/files/TeachersImplementation.zip",
      "convention":"JAVA",
      "feedback":[
         ":TEST",
         "Even:CUSTOM:4:You only tested the method with odd numbers.",
         "Even:CUSTOM:6:You only tested the method with even numbers."
      ]
   }
}
```

Lastly, the configuration needs to be transferred to the Cloud check feedback action in Quarterfall.
For this purpose, we can press the "Copy to Clipboard" button below the representation of the JSON object on the web form homepage.
In Quarterfall navigate to the Code feedback action of the question you have created in the beginning of this tutorial.
In this Code action, enter `qf.mass = ` and paste the configuration you have juste copied.
The Quartefall Feedback actions should now look as follows.
(Actually, the JSON object is copied without any pretty-printing consisting of just one line. For better readability of the screenshot, we have inserted newlines and indentation):

![Mass configuration Quarterfall Cloud check action finished.](images/cov_quarterfall-finished.png)
