# Test Coverage Checker Tutorial

In this tutorial you will learn how to configure the Coverage Checker.
Therefore we will configure feedback for following assignment.

## Table of Contents
1. [General Information](#coverage-general-information)
2. [Used Example](#coverage-used-example)
3. [Configuration in Quarterfall](#coverage-config)
   1. [Configuration via MASS Configuration web form](#coverage-from-website)
   2. [Configuration Walkthrough](#coverage-configuration-walkthrough)
      1. [Private Base Implementation](#coverage-base-implementation)
      2. [Adding to the report](#coverage-configuration-checkboxes)
      3. [Configure the Feedback](#coverage-configure-feedback)
   3. [Transferring the Configuration to Quarterfall](#coverage-transferring-to-quarterfall)


## <a id="coverage-general-information"></a>General Information
The Test Coverage Checker is a part of the MASS Checker.
It generates feedback regarding to the completeness of tests written by a learner.
The approach of the checker is to perform a test coverage analysis while running the
tests in a student-submitted solution.
The base code, which is tested, can either be part of the student solution or predefined
base code can be provided by the teacher.
The feedback generated by this checker reports which lines of the base code are not
covered during the test execution.
To make feedback messages more specific, teachers can specify dedicated messages
associated with specified line numbers of un-covered code.
This is most useful when the base code is provided by the teacher, as the purpose of
these code lines is exactly known in this case.

## <a id="coverage-used-example"></a>Used Example

The example assignment used in this tutorial is to write tests for class `Even` shown below.

```java
class Even {
	public boolean isTrue(int num) {
		if (num % 2 == 0) {
			return true;
		} else {
			return false;
		}
	}
}
```

Thereby we anticipate three mistakes that students can make and for which we want to generate helpful feedback messages:
1. A test case fails.
2. The student solution only tested with an odd number as argument.
3. The student solution only tested with an even number as argument.

Naturally, compiler errors also lead to feedback generated by our checker, but this is not the subject of this tutorial.

## <a id="coverage-config"></a>Configuration in Quarterfall

First, we need to create a question is Quarterfall. Since students only need to provide a single class, they do not
need to submit multiple files. Instead, we decide to create a "Code question", which includes a text field where students
can immediately enter their solution.  As question text, we enter the following:

````markdown
Write the class `EvenTest` which tests the implementation of the class `Even` shown below.
This class just contains one method `isTrue` which is supposed to return `true` if the passed
integer value is an even number. 

```java
class Even {
	public boolean isTrue(int num) {
		if (num % 2 == 0) {
			return true;
		} else {
			return false;
		}
	}
}
```
````

For the Programming Lanaguage, select "Java" which will enable proper syntax highlighting in the solution text editor available to the students.
It is a good idea to provide a template for the solution to avoid that students make mistakes when naming their test class
and to rid them from needing to provide the required import statements. Therefore, we enter the following as the "Template":

```java
import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.Test;

class EvenTest {

   @Test
   void test() {
      fail("Not yet implemented");
   }

}
```

You could select the tab "Solution" in Quarterfall and provide a sample solution that can be shown to students.
But we leave this out for the tutorial.

Next, we need to configure the Mass checker. For this purpose, we select the "Feedback" tab and a Code action and a
Cloud check action.
For the basic steps to configure this feedback as well as the parameter values that need to be provided, please refer
to the main [MASS documentation](/mass/documentation)
The specific configuration of the Coverage Checker will be explained in this tutorial.

![Question in Quartefall.](images/cov_quarterfall-question.png)

### <a id="coverage-from-website"></a>Configuration via MASS Configuration web form
To specify the configuration, we use the [MASS Configuration web form](/mass/configurator).
The above link sends you directly to our configurator where you can configure all the Mass checkers.
But for this tutorial, we only need the Test Coverage Checker. To enable configuring this, select the check box
***Enable Test Coverage Checker*** in the web form.
Now, you should be able to see that ***Test Coverage Checker*** appears in the blue bar at the top as in the following screenshot.

![Mass configuration web form.](images/cov_web-form-coverage-enabled.png)

### <a id="coverage-configuration-walkthrough"></a>Configuration Walkthrough

Click on ***Test Coverage Checker*** and the configurator will let you configure this checker.

![Mass configuration web form page for the Test Coverage Checker.](images/cov_web-form-empty.png)

#### <a id="coverage-base-implementation"></a>Private Base Implementation

For the assignment in this tutorial, we want to provide a predefined implementation of the class shown at the top.
For this purpose, we need to provide a ZIP file containing this class at a publicly accessible URL.
This URL is only known to the Feedback action in Quarterfall and cannot be determined by students,
therefore the implementation will not be accessible to students.
The ZIP file should contain the source files of the required classes and the folder structure within the ZIP file
should follow Java conventions (i.e., the default package is the root of the ZIP file and packages are sub folders).
For the purpose of this tutorial, we provide an appropriate ZIP file at this URL:

[https://qped-eu.github.io/mass/files/TeachersImplementation.zip](https://qped-eu.github.io/mass/files/TeachersImplementation.zip)

![Mass configuration web form - private base implementation.](images/cov_web-form-base-implementation.png)

### <a id="coverage-configuration-checkboxes"></a>Adding to the report

Next, we have two options to configure the general feedback:

- Show Test Failures

- Show Full Report

One of these two, both or neither can be checked.
These two options will add to the specified feedback but won't substract from it.
**Show Test Failures** will add to the generated feedback whether tests specified by the learner have failed.
This can be helpful feedback for the learner but might not be wanted in every scenario.
For this tutorial, we will not enable this option.

**Show Full Report** will generate a full report of every line that was not reached by the learner's tests.
This option is often useful if a private implementation is not used as a reference.
We, however, are using a private implementation for this tutorial, so we won't use this option.

### <a id="coverage-configure-feedback"></a>Configure the feedback

Now that we have selected the format of the report, we also want to specify feedback that should be generated in certain scenarios.
To add a feedback message, click on the **+**-button next to **Feedback Configuration**.
Your configurator should now look something like this:

![Mass configuration web form - add feedback.](images/cov_web-form-add-feedback.png)

First of all, let's explain what just happened:
We've just added a new entry for feedback.
As you can see, some of the newly added entries are marked red.
This means, that they are required and should contain a value.

The options you can fill out are as follows:

- **Message ID**
An ID that can be given for a specific message.
This ID is optional but can be useful under certain circumstances which will be explained later.
An ID is always optional.

- **Kind of Coverage Miss**
You have the choice between *FULLY_MISSED* and *PARTIAL_MISS*.
*FULLY_MISSED* designates that a line or a range of lines need to be fully missed and not only partially missed.
If you want to check a range, for instance, every single line of range would need to be missed in order to get a feedback message for this type.
*PARTIAL_MISS* designates that a line or a range of lines only need to be missed partially.
This means, that if you have specified a range, only one line would need to be missed in order for this type of feedback to be used.

- **File Name**
The name of the file in which a given class is located.
This is especially important if you have a project with multiple classes and files.

- **Line Ranges**
Multiple line ranges can be given.
They all need to be seperated by a comma if you have more than one range.
Instead of a range, a single line can also be given.
Ranges have to form of X - Y, whereas single lines can be designated as X.

- **Message**
This field designates the message that will be displayed if a miss is detected.
The message has no limit on its length and can be customized with markdown.#

- **Supressed Message**
This field can implement a hierarchy in the messages to be displayed.
It uses the ID specified in the first field to suppress a message if this message is triggered.
For example, you could specify a message for a given method and supress it if a specific path through the method is ignored.
This gives more flexibility for feedback.

Now that all the fields have been explained, we will adapt them to our given example.
In our example, we have one method to test: *isTrue*.
Therefore we want to add the following messages:

- A message that triggers if the whole method is not covered.

- A message that triggers if the even path is not covered. This should suppress the first message.

- A message that triggers if the odd path is no covered. This should suppress the first message.

If you have entered every value correctly, your configuration should look like this:
![Mass configuration web form - finished configuration.](images/cov_web-form-feedback-added.png)

### <a id="coverage-transferring-to-quarterfall"></a>Transferring the Configuration to Quarterfall

After following the steps in this tutorial the web form should look like the following screenshot.

![Mass configuration web form finished.](images/cov_web-form-finished.png)

The following JSON object has been built which is shown either to the right of the web form or below it:

```json
{
  "styleSelected": false,
  "semanticSelected": false,
  "coverageSelected": true,
  "classSelected": false,
  "metricsSelected": false,
  "syntax": {
    "level": "BEGINNER"
  },
  "coverage": {
    "privateImplementation": "https://qped-eu.github.io/mass/files/TeachersImplementation.zip",
    "showTestFailures": false,
    "showFullCoverageReport": false,
    "feedback": [
      {
        "showFor": "FULLY_MISSED",
        "fileName": "Even.java",
        "lineRanges": "2-8",
        "message": "You have not tested this method at all.",
        "suppresses": "EVEN, ODD"
      },
      {
        "showFor": "PARTIALLY_MISSED",
        "fileName": "Even.java",
        "lineRanges": "3-4",
        "message": "You should test for even numbers.",
        "ID": "EVEN"
      },
      {
        "showFor": "PARTIALLY_MISSED",
        "fileName": "Even.java",
        "lineRanges": "5-6",
        "message": "You should test for odd numbers.",
        "ID": "ODD"
      }
    ]
  }
}
```

Lastly, the configuration needs to be transferred to the Cloud check feedback action in Quarterfall.
For this purpose, we can press the "Copy to Clipboard" button below the representation of the JSON object on the web form homepage.
In Quarterfall navigate to the Code feedback action of the question you have created in the beginning of this tutorial.
In this Code action, enter `qf.mass = ` and paste the configuration you have juste copied.
The Quartefall Feedback actions should now look as follows.
(Actually, the JSON object is copied without any pretty-printing consisting of just one line. For better readability of the screenshot, we have inserted newlines and indentation):

![Mass configuration Quarterfall Cloud check action finished.](images/cov_quarterfall-finished.png)
