# *Test Coverage Checker* Tutorial

In this tutorial you will learn how to configure the *Coverage Checker*.
For this purpose, we will configure feedback for following assignment.

## Table of Contents
1. [General Information](#coverage-general-information)
2. [Used Example](#coverage-used-example)
3. [Configuration in *Quarterfall*](#coverage-config)
   1. [Configuration via *MASS Configuration* web form](#coverage-from-website)
      1. [Teacher's implementation of application classes](#coverage-base-implementation)
      2. [Adding to the report](#coverage-configuration-checkboxes)
      3. [Configure the Feedback](#coverage-configure-feedback)
   3. [Transferring the Configuration to *Quarterfall*](#coverage-transferring-to-quarterfall)


## <a id="coverage-general-information"></a>General Information
The *Test Coverage Checker* is a part of the *MASS Checker*.
It generates feedback regarding to the completeness of tests written by a learner.
The approach of the checker is to perform a test coverage analysis while running the
tests in a student-submitted solution.
Teachers can also provide additional code or code replacing parts of the student solution.
In this way, e.g., a predetermined implementation for the application code to be tested can be provided.
The feedback generated by this checker reports which lines of the application code are not
covered during the test execution.
To make feedback messages more specific, teachers can specify dedicated messages
associated with specified line numbers of un-covered code.
This is most useful when the application code is provided by the teacher, as the purpose of
these code lines is exactly known in this case.

## <a id="coverage-used-example"></a>Used Example

The example assignment used in this tutorial is to write tests for the class `Even` shown below.

```java
class Even {
	public boolean isTrue(int num) {
		if (num % 2 == 0) {
			return true;
		} else {
			return false;
		}
	}
}
```

Thereby we anticipate four mistakes that students can make and for which we want to generate helpful feedback messages
on the tests submitted ad the student's solution:
1. A test case fails.
2. The method `isTrue` is not tested at all.
3. The method `isTrue` is only tested with an odd number as argument.
4. The method `isTrue` is only tested with an even number as argument.

Naturally, compiler errors also lead to feedback generated by our checker.
For more information, see the description of the [Syntax Checker](/mass#mass-basic-configuration) and its configuration.

## <a id="coverage-config"></a>Configuration in *Quarterfall*

First, we need to create a question is *Quarterfall*.
In this example, students are supposed to submit a single test class.
Thus, we decide to create a ***Code question***, which includes a text field where students
can immediately enter their solution. As ***Question text***, we enter the following:

````markdown
Write the class `EvenTest` which tests the implementation of the class `Even` shown below.
This class just contains one method `isTrue` which is supposed to return `true` if the passed
integer value is an even number. 

```java
class Even {
	public boolean isTrue(int num) {
		if (num % 2 == 0) {
			return true;
		} else {
			return false;
		}
	}
}
```
````

For the ***Programming language***, select ***Java*** which will enable proper syntax highlighting in the solution text editor available to the students.
It is a good idea to provide a template for the solution to avoid that students make mistakes when naming their test class
and to rid them from needing to provide the required import statements.

> :information_source: The coverage checker needs to recognize test classes, which it does by their name.
> All test classes provided either as student solution or in the instructor resources must either start or end with `Test` or `test`.
> Thereby only the simple name is considered, i.e., the package name is ignored.
> For example a class recognized as test would be `my_package.Simpletest`.

Therefore, we enter the following as the ***Template***:

```java
import static org.junit.jupiter.api.Assertions.*;
import org.junit.jupiter.api.Test;

class EvenTest {

   @Test
   void test() {
      fail("Not yet implemented");
   }

}
```

You could select the tab ***Solution*** in *Quarterfall* and provide a sample solution that can be shown to students.
But we leave this out for the tutorial.

Next, we need to configure the *MASS checker*. For this purpose, we select the ***Feedback*** tab and add a ***Code action*** as well as a ***Cloud check*** action.
For the basic steps to configure this feedback as well as the parameter values that need to be provided, please refer
to the [*MASS Homepage*](/mass#mass-in-Quarterfall)
The specific configuration of the Coverage Checker will be explained in this tutorial.

![Question in *Quarterfall*.](images/cov_quarterfall-question.png)

### <a id="coverage-from-website"></a>Configuration via *MASS Configuration* web form
To specify the configuration, we use the [*MASS Configuration* web form](/mass/configurator).
The above link sends you directly to our configurator where you can configure all the *MASS checkers*.

#### <a id="coverage-base-implementation"></a>Teacher's implementation of application classes

First, we need to configure the ***Main settings***.
For the assignment in this tutorial, we want to provide a predefined implementation of the class shown at the top.
For this purpose, we need to provide a ZIP file containing this class at a publicly accessible URL.
This URL is only known to the Feedback action in *Quarterfall* and cannot be determined by students,
therefore the implementation will not be accessible to students.
The ZIP file should contain the source files of the required classes and the folder structure within the ZIP file
should follow Java conventions (i.e., the default package is the root of the ZIP file and packages are sub folders).

There are multiple ways of providing and specifying this ZIP file.
One possibility is to upload it to a file hoster where it is publicly available and then specify the URL of this file.
For example, the teacher's implementation used for this tutorial is available at the following URL:
[https://qped-eu.github.io/mass/files/TeachersImplementation.zip](https://qped-eu.github.io/mass/files/TeachersImplementation.zip)

Another possibility is to upload the file in the *Quarterfall* assignment, but there is no easy way to determine the public URL to access this file.
Therefore, the *MASS checker* offers a custom protocol to be used in the URL for the instructor resources, which is `qf`.
For the path of the URL we concatenate the label and the extension of the desired file in *Quarterfall*, thus our URL is [qf:TeachersImplementation.zip](qf:TeachersImplementation.zip).

![Uploaded teacher's implementation in *Quarterfall*.](images/cov_quarterfall-files.png)

Next, on the ***Main Settings*** page, we configure the ***Student Level***.
This determines the way in which syntax errors are reported.
We simply leave this at the default setting, which is `BEGINNER`.

Further, for this tutorial, we need to configure the *Test Coverage Checker*. To enable configuring this, select the check box
***Enable Test Coverage Checker*** in the web form.
Now, you should be able to see that ***Test Coverage Checker*** appears in the blue bar at the top as in the following screenshot.
The main settings in the configuration editor should now look as in the following screenshot.

![*MASS Configuration* web form page for the Test Coverage Checker (Main Settings).](images/cov_main-settings.png)

#### <a id="coverage-configuration-checkboxes"></a>Adding to the report

Now click on ***Test Coverage Checker*** and the configurator will let you configure this checker.
The screenshot below shows this configuration page with default values.
As you can see, there are some validation errors, because some mandatory values are missing for which no meaningful defaults can be provided.
We fill in the missing data in this tutorial.

![*MASS configuration* web form page for the Test Coverage Checker.](images/cov_web-form-empty.png)

At the top, we see two options, which we can select. Thereby, the option ***Show Test Failures*** is selected by default.
Selecting one or both of these options will add generic reports to the *Coverage Checker*'s feedback messages.

- **Show Test Failures** will add to the generated feedback which of the executed tests have failed. 
In the questions defined in this tutorial, students are supposed to submit the test implementation and the tested application code is provided by the teacher.
Since we assume that the teacher's implementation is correct, test failures will be due to erroneous test implementations.
Therefore, test failures are relevant to students, which is why we leave this option enabled as is already the default.

- **Show Full Coverage Report** will generate a full report showing all lines of all application code, indicating for each line whether it was covered or not.
Lines can be *FULLY covered*, *NOT covered* or *PARTIALLY covered*.
The latter means that some but not all statements  or sub-expressions in the line have been executed/evaluated.
(This difference to *FULLY covered* can be of particular relevance for shortcut evaluation as in `v != null && v.predicate()`: if the comparison `v != null` fails, the invocation of `v.predicate()` is never executed.)
But since the *Full Coverage Report* can get very long and since it would include the teacher's implementation of the application code, we do not want to show it in this tutorial.
Therefore, we again keep the default leaving the checkbox disabled this time.

#### <a id="coverage-configure-feedback"></a>Configure the feedback

Now that we have selected the format of the report, we also want to specify feedback that should be generated in certain scenarios.
One feedback message is already defined as a default, although this is still empty.
You even see some validation errors, because mandatory information is missing.
To add further feedback messages, click on the ***+***-button next to ***Feedback Configuration***.

The options you can fill out for a feedback message are as follows:

- **Message ID**
An ID that can be given for a specific message.
This ID is optional but can be useful under certain circumstances which will be explained later.
An ID is always optional.

- **Kind of Coverage Miss**
You have the choice between `FULLY_MISSED` and `PARTIAL_MISSED`.
`FULLY_MISSED` designates that a line or a range of lines need to be fully missed and not only partially missed.
If you want to check a range, for instance, every single line of range would need to be completely missed in order to get a feedback message for this type.
`PARTIAL_MISS` designates that a line or a range of lines only need to be missed partially.
This means, that if you have specified a range, only one line or some statements or expressions would need to be missed in order for this type of feedback to be used.

- **File Name**
The name of the file in which a given class is located.
Note that this is the name of the file rather than the class.
I.e., if the file contains multiple classes and you are interested in the coverage of all those classes, you would have to specify the same file name here.
If the file is inside a package, the file name would have to contain the full path using `/` as separator and without leading separator.
For example, you have a class `MyClass` in the package `my_package`, the file name would be `my_package/MyClass.java`.

- **Line Ranges**
Multiple line ranges can be given.
They all need to be separated by a comma if you have more than one range.
Instead of a range, a single line can also be given.
Ranges have to form of `X - Y`, whereas single lines can be designated as `X`.

- **Message**
This field designates the message that will be displayed if a miss is detected.
The message has no limit on its length and can be customized with markdown.

- **Suppressed Messages**
This field can implement a hierarchy in the messages to be displayed:
If the current message is applicable, it will prevent all the messages from being shown, which are listed in the field ***Suppressed Messages***.
Thereby, you must refer to feedback messages by means of their ***ID***, specified in the first field of their definition.

Now that all the fields have been explained, we will adapt them to our given example.
In our example, we have one method to test: `isTrue`.
Therefore, we want to add the following messages. The implementation of this message is in the file `Even.java`, which is in the default package.
Therefore, we will put this as file name for all messages.

- A message that triggers if the whole method is not covered. We specify all lines in which the method is defined which are lines `2 - 8` (line numbering starts at *1* for the first line within a file).
Note that lines not containing executable statements or expressions are ignored by the coverage analysis. 
Therefore, coverage is actually not measured for lines 2, 5, 7 and 8.
But since empty lines are simply ignored, specifying the whole source range is better readable.
If the method `isTrue` is not covered at all (`FULLY_MISSED`), we also do not want to show further messages about which cases have been missed in particular, as this would give away too much of the solution.
Therefore, whe specify that the messages with the ***ID*** `EVEN` and `ODD`, defined below, are suppressed, i.e., we enter the comma-separated list of these ***ID***'s `EVEN,ODD` for the field ***Suppressed Messages***.

- A message that triggers if the even path is not covered.
As ***ID*** we specify `EVEN`, to which the first feedback message refers in the ***Suppressed Messages*** field.
For the ***Line Range*** we enter just line `4` which is the `return` statement that is only executed when the method argument an even number.
We enter `PARTIALLY_MISSED` as ***Kind of Coverage Miss*** to be cautious. As the line only contains one statement, a partial miss and a full miss are actually the same.
But if the implementation were more complex, we would also like to inform students when only part of the handling of even numbers is missed.

- A message that triggers if the odd path is no covered.
The reasoning and configuration is pretty much the same as for the message above.
Only we specify `ODD` as the messages ***ID*** and the relevant ***Line Range*** is line `6`. 

If you have entered every value correctly, your configuration should look like this:

![*MASS Configuration* web form - finished configuration.](images/cov_web-form-feedback-added.png)

### <a id="coverage-transferring-to-quarterfall"></a>Transferring the Configuration to *Quarterfall*

After following the steps in this tutorial, the web form should look like the following screenshot.
The ***Configuration Data*** section, which is shown either to the right of the web form or below it, shows the final JSON object for the configuration of the *MASS checker*.

![*MASS Configuration* web form finished.](images/cov_web-form-finished.png)

Lastly, the configuration needs to be transferred to the Cloud check feedback action in *Quarterfall*.
For this purpose, we can press the ***Copy to Clipboard*** (first button after the heading ***Configuration Data***) on the web form homepage.
Note that this does not only insert the JSON object into the clipboard but also puts the required assignment `qf.mass = ` in front of it.
Thus, after pressing this button, the content of the clipboard is as follows:

```json
qf.mass = {
   "styleSelected": false,
   "semanticSelected": false,
   "coverageSelected": true,
   "classSelected": false,
   "metricsSelected": false,
   "syntax": {
      "level": "BEGINNER"
   },
   "coverage": {
      "showTestFailures": true,
      "showFullCoverageReport": false,
      "feedback": [
         {
            "showFor": "FULLY_MISSED",
            "fileName": "Even.java",
            "lineRanges": "2-8",
            "message": "You have not tested this method at all.",
            "suppresses": "EVEN, ODD"
         },
         {
            "showFor": "PARTIALLY_MISSED",
            "fileName": "Even.java",
            "lineRanges": "4",
            "message": "You should test for even numbers.",
            "ID": "EVEN"
         },
         {
            "showFor": "PARTIALLY_MISSED",
            "fileName": "Even.java",
            "lineRanges": "6",
            "message": "You should test for odd numbers.",
            "ID": "ODD"
         }
      ]
   },
   "instructorResources": "qf:TeachersImplementation.zip"
}
```

Now, in *Quarterfall*, navigate to the feedback ***Code action*** of the question you have created in the beginning of this tutorial.
In this ***Code action***, paste the configuration you have just copied.
The *Quarterfall* feedback actions should now look as follows.

![*MASS Configuration* *Quarterfall* ***Cloud Check Action*** finished.](images/cov_quarterfall-finished.png)
![Screenshot of the ***Cloud Check Action*** in *Quarterfall*.](images/quarterfall_cloudcheck-action.png)

The assignment created in this tutorial can also be imported in *Quarterfall* by using 
this share code: `CODAGL`.
For help on sharing and importing assignments in *Quarterfall*, please refer to the [Assignment Settings 
help page](https://help.quarterfall.com/article/171-assignment-settings).